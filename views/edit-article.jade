extends ./layout.jade



block title
  title Edit Article
block content
  form.form-article(method="post" action="/admin/edit-article")
    div.form-group
      label Select Story
      select.form-control(id="select" name="parent_article_id" onchange="selStory(this)")
        option(value="") New Story
        each story, i in stories
          option(value="#{story._id}") #{story.title}
          each post in story.posts
            option(value="#{post._id}") -- #{post.title}
    div.form-group
      label Title
      input.form-control(id="title" type="text" placeholder="title" name="title")
    div.form-group
      label Body
      textarea.form-control(rows="15" id="body" name="body")
    input(type="hidden" name="author" value="#{author}")
    button.btn.btn-default(type="submit") Edit Article


    script.
      var st = !{JSON.stringify(stories)};

      var title = document.getElementById('title');
      var body = document.getElementById('body');

      function selStory(sel){
        for(var i=0; i<st.length; i++){
          if(st[i]._id == sel.value){
            title.value = st[i].title;
            body.value = st[i].body;
          }
          else if(st[i].posts.length>0){
            for(var x=0; x<st[i].posts.length; x++){
              if(st[i].posts[x]._id == sel.value){
                title.value = st[i].posts[x].title;
                body.value = st[i].posts[x].body;
              }
            }
          }
        }
      }